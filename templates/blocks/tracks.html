<div class="tracks" id="tracks-page">
  {% if user %}
    <div class="explain style card">
      <h2><span style="font-size: 1.8em; font-weight: bold;">Your Activity</span></h2>
      <p>
        <span style="font-size: 1em;">Each track includes</span>
        <span style="font-size: 1.2em; font-style: italic; font-weight: bold; color: var(--primary-dark)">details</span>,
        <span style="font-size: 1.2em; font-style: italic; font-weight: bold; color: var(--primary-dark)">genres</span>, and
        <span style="font-size: 1.2em; font-style: italic; font-weight: bold; color: var(--primary-dark)">recommendations</span>
        <span style="font-size: 1em;">to help you explore more music you’ll love.</span>
      </p>
    </div>
    <div class="music-col-toggle style card">
      <input type="checkbox" id="switch" />
      <label for="switch">
        <span class="yes">Top Songs</span>
        <span class="no">Recent Songs</span>
        <div class="slider style card"></div>
      </label>
    </div>
    {% for section, tracks in [("top-songs", top_tracks), ("recent-songs", recent_tracks)] %}
      <div class="music-cols {{ section }}">
        {% for track in tracks %}
          <div class="record style card">
            <div class="main">
              <a class="image style" href="{{ track.album_url }}">
                <img src="{{ track.album_art }}" alt="{{ track.name }}">
              </a>
              <div class="details-div">
                <div class="top">
                  <a href="{{ track.url }}"><h3>{{ track.name }}</h3></a>
                  <a href="{{ track.artist_url }}"><h4>{{ track.artist }}</h4></a>
                  <a href="{{ track.album_url }}"><h5>{{ track.album }}</h5></a>
                </div>
                <button class="toggle-more style btn">▼ See More</button>
              </div>
            </div>
            <div class="expandable">
              <div class="genres-row">
                {% if track.genres %}
                  {% for g in track.genres %}
                    <a class="style link" href="https://www.google.com/search?q={{ g | urlencode }}" target="_blank">{{ g }}</a>
                  {% endfor %}
                {% else %}
                  <a class="style link" href="https://www.google.com/search?q={{ track.artist | urlencode }}" target="_blank">{{ track.artist }}</a>
                {% endif %}
              </div>
                <div class="similar-row">
                  {% if track.similar_songs %}
                    {% for s in track.similar_songs %}
                      {% if s is mapping %}
                        {% for song_name, artist_name in s.items() %}
                          <div class="similar-song style card">
                            <p class="song-line">
                              <a href="https://www.google.com/search?q={{ (song_name + ' - ' + artist_name) | urlencode }}" target="_blank">
                                <span class="song-name">{{ song_name }}</span> — 
                                <span class="artist-name">{{ artist_name }}</span>
                              </a>
                            </p>
                          </div>
                        {% endfor %}
                      {% else %}
                        <p>{{ s }}</p>
                      {% endif %}
                    {% endfor %}
                  {% else %}
                    <div style="display: flex; flex-direction: row; height:50px; align-items:center; justify-content: space-between">
                      <p>Couldn't find similar songs.</p>
                      <a class="style link" style="align-items:center; height:100%" href="https://www.google.com/search?q={{ (track.name + ' - ' + track.artist) | urlencode }}" target="_blank">Search Google</a>
                    </div>                      
                    </p>
                  {% endif %}
                </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% endfor %}
  {% else %}
    <div class="gap"></div>
    <div class="login style btn active">
      <a href="/login">Login</a>
    </div>
  {% endif %}
</div>